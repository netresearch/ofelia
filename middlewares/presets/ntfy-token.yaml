name: ntfy-token
description: "ntfy.sh push notifications with Bearer token authentication for self-hosted instances or private topics"
version: "1.0.0"

url_scheme: "https://ntfy.sh/{id}"

method: POST
headers:
  Content-Type: "application/json"
  Authorization: "Bearer {secret}"

variables:
  id:
    description: "ntfy topic name"
    required: true
    example: "ofelia-alerts"
  secret:
    description: "ntfy access token (required for private topics)"
    required: true
    sensitive: true
    example: "tk_AgQdq7mVBoFD37zQVN29RhuMzNIz2"

body: |
  {
    "topic": "{{.Job.Name}}",
    "title": "Ofelia: {{.Job.Name}} - {{.Execution.Status}}",
    "message": "Job {{.Job.Name}} {{if .Execution.Failed}}failed{{else if .Execution.Skipped}}was skipped{{else}}completed successfully{{end}} in {{.Execution.Duration}}{{if .Execution.Failed}}\n\nError: {{.Execution.Error}}{{end}}",
    "priority": {{if .Execution.Failed}}5{{else if .Execution.Skipped}}3{{else}}3{{end}},
    "tags": [
      {{- if .Execution.Failed }}"warning","x"
      {{- else if .Execution.Skipped }}"hourglass"
      {{- else }}"white_check_mark"
      {{- end }}
    ],
    "click": "",
    "actions": []
  }
